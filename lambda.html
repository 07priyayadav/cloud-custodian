<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>CloudMaid Lambda Integration &mdash; Cloud Maid 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Cloud Maid 1.0 documentation" href="index.html" />
    <link rel="next" title="Offhours support" href="offhours.html" />
    <link rel="prev" title="Roadmap" href="roadmap.html" /> 
  </head>
  <body role="document">
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="index.html">Cloud Maid 1.0 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="roadmap.html" title="Roadmap"
             accesskey="P">previous</a> |
          <a href="offhours.html" title="Offhours support"
             accesskey="N">next</a> |
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <span class="target" id="module-janitor.mu"></span><div class="section" id="cloudmaid-lambda-integration">
<h1>CloudMaid Lambda Integration<a class="headerlink" href="#cloudmaid-lambda-integration" title="Permalink to this headline">¶</a></h1>
<p>Lambda provides for powerful realtime and near realtime compliance
execution when integrated in with a number of different amazon
services as event sources.</p>
</div>
<div class="section" id="aws-cloud-config">
<h1>AWS Cloud Config<a class="headerlink" href="#aws-cloud-config" title="Permalink to this headline">¶</a></h1>
<p>One event source is using AWS Cloud Config, which provides versioned
json representation of objects into s3 with rules execution against
them.  Config Rules allow for lambda execution against these resource
states to determine compliance along with a nice dashboard targeted
towards visualizing compliance information over time. At the moment
config rules execute after the resource is already active, based on the
underlying resource poll and config snapshot delivery.</p>
<p>Underlying the hood aws config and config rules, appear to be just
productizing a poll of some resources into json files in s3 with
lambda and versioned metrics reports. At the moment config rules
only support items managed under the ec2 api (ec2, ebs, network) which
means they have significant coverage gap when looking at the totality
of aws services since they only cover a single api. As a result atm,
they are best suited to orgs that are using a small subset of aws that
requires audit (ie. just ec2) and prefer a pre-configured dashboard on
that subset. Of course overtime the config service will evolve.</p>
<p>However for capabilities and reporting around compliance Netflix
security monkey would be a better choice atm imo. Maid distinguishes
in its configurable policy engine, as opposed to hard coded, ability
to run serverless, better integration with current best aws practices
and provides remediation and enforcement capabilities.</p>
<p>Open question on config rules, Its unclear if rules execute against
only on a delta to a resource or against each config snapshot..</p>
<p>For a wider range of coverage and functionality we turn to</p>
</div>
<div class="section" id="cloud-watch-events">
<h1>Cloud Watch Events<a class="headerlink" href="#cloud-watch-events" title="Permalink to this headline">¶</a></h1>
<p>Cloud watchs events is a general event bus for aws infrastructure, atm
it covers two major sources of information, real time instance status events
and cloud trail api calls over a poll period on cloud trail delivery.</p>
<p>Cloud trail provides a much richer data source over the entire range
of aws services exposed via the audit trail to enable defining
compliance policy effectively against any aws product.</p>
<p>Additionally for ec2 instances we can provide mandatory policy
compliance, that effectively means the non compliant resource never
became available.</p>
</div>
<div class="section" id="cloud-maid-integration">
<h1>Cloud Maid Integration<a class="headerlink" href="#cloud-maid-integration" title="Permalink to this headline">¶</a></h1>
<p>Maid provides for policy level execution against any lambda subscribable
event stream.</p>
<p>We reconstitue current state for the given resource and execute
the policy against it, matching against the policy filters, and applying
the policy actions.</p>
<p>Mu is the letter after lambda, lambda is a keyword in python.</p>
</div>
<div class="section" id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<p>Examples</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">policies</span><span class="p p-Indicator">:</span>

  <span class="c1"># Cloud Watch Events over CloudTrail api calls (1-15m trailing)</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-tag-compliance</span>
    <span class="l l-Scalar l-Scalar-Plain">mode</span><span class="p p-Indicator">:</span> 
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cloudtrail</span>
      <span class="l l-Scalar l-Scalar-Plain">sources</span><span class="p p-Indicator">:</span> 
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ec2.amazonaws.com</span>
      <span class="l l-Scalar l-Scalar-Plain">events</span><span class="p p-Indicator">:</span> 
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">RunInstances</span>
      <span class="c1"># For cloud trail events we need to reference the resources id</span>
      <span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span> <span class="s">&quot;detail.responseElements.instancesSet.items[].instanceId&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">or</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">tag:required1</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">tag:required2</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
    <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stop</span>

  <span class="c1"># On EC2 Instance state events (real time, seconds)</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-require-encrypted-volumes</span>
    <span class="l l-Scalar l-Scalar-Plain">mode</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-instance-state</span>
      <span class="l l-Scalar l-Scalar-Plain">events</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pending</span>
    <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ebs</span>
        <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Encrypted</span>
        <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
    <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mark</span>
      <span class="c1"># TODO delete instance volumes that</span>
      <span class="c1"># are not set to delete on terminate</span>
      <span class="c1"># currently we have a poll policy that</span>
      <span class="c1"># handles this.</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">terminate</span>

  <span class="c1"># Periodic Function</span>
  <span class="c1"># Syntax for scheduler per http://goo.gl/x3oMQ4</span>
  <span class="c1"># Supports both rate per unit time and cron expressions</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">s3-bucket-check</span>
    <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">s3</span>
    <span class="l l-Scalar l-Scalar-Plain">mode</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">periodic</span>
      <span class="l l-Scalar l-Scalar-Plain">schedule</span><span class="p p-Indicator">:</span> <span class="s">&quot;rate(1</span><span class="nv"> </span><span class="s">day)&quot;</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developer Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Roadmap</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">CloudMaid Lambda Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="#aws-cloud-config">AWS Cloud Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="#cloud-watch-events">Cloud Watch Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="#cloud-maid-integration">Cloud Maid Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="offhours.html">Offhours support</a></li>
<li class="toctree-l1"><a class="reference internal" href="offhours.html#tag-based-configuration">Tag Based Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="offhours.html#policy-examples">Policy examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="offhours.html#options">Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="filter-values.html">Value Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="ec2.html">EC2 Policy Definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="s3.html">S3 Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="comparisons.html">Comparisons</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
            <p class="searchtip" style="font-size: 90%">
                Enter search terms or a module, class or function name.
            </p>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="roadmap.html" title="Roadmap"
              >previous</a> |
            <a href="offhours.html" title="Offhours support"
              >next</a> |
            <a href="py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="_sources/lambda.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Kapil Thangavelu.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>