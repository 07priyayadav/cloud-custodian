<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Lambda Support &mdash; Cloud Maid 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Cloud Maid 1.0 documentation" href="index.html" />
    <link rel="prev" title="Comparisons" href="comparisons.html" /> 
  </head>
  <body role="document">
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="index.html">Cloud Maid 1.0 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="comparisons.html" title="Comparisons"
             accesskey="P">previous</a> |
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="lambda-support">
<h1>Lambda Support<a class="headerlink" href="#lambda-support" title="Permalink to this headline">¶</a></h1>
<p>Lambda provides for powerful realtime event based code execution in
response to infrastructure and application behavior. A number of
different amazon services can be used as event sources.</p>
<div class="section" id="cloud-watch-events">
<h2>Cloud Watch Events<a class="headerlink" href="#cloud-watch-events" title="Permalink to this headline">¶</a></h2>
<p>Cloud watchs events is a general event bus for aws infrastructure, atm
it covers several major sources of information, cloud trail api calls
over a poll period on cloud trail delivery, real time instance status
events, autoscale group notifications, and scheduled/periodic events.</p>
<p>Cloud trail provides a very rich data source over the entire range
of aws services exposed via the audit trail that allows maid to define
realtime policies effectively against any aws product.</p>
<p>Additionally for ec2 instances we can provide mandatory policy
compliance, that effectively means the non compliant resource never
became available.</p>
</div>
<div class="section" id="cloud-maid-integration">
<h2>Cloud Maid Integration<a class="headerlink" href="#cloud-maid-integration" title="Permalink to this headline">¶</a></h2>
<p>Maid provides for policy level execution against any cwe event
stream. Each maid policy can be deployed as an independent lambda
function. The only difference between a maid policy that runs in
lambda a event/reactive push mode and one that runs directly from the
cli in poll mode is the specification of the events to subscribe to
in the mode config block of the policy.</p>
<p>Internally maid will reconstitue current state for all the resources
in the event and execute the policy against them, matching against the
policy filters, and applying the policy actions to matching resources.</p>
<p>Mu is the letter after lambda, lambda is a keyword in python.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Examples</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">policies</span><span class="p p-Indicator">:</span>

  <span class="c1"># Cloud Watch Events over CloudTrail api calls (1-15m trailing)</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-tag-compliance</span>
    <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>

    <span class="c1"># The mode block is the only difference between a maid policy that</span>
    <span class="c1"># runs in reactive/push mode via lambda and one that runs in poll mode.</span>
    <span class="l l-Scalar l-Scalar-Plain">mode</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cloudtrail</span>
      <span class="l l-Scalar l-Scalar-Plain">events</span><span class="p p-Indicator">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">RunInstances</span>

      <span class="c1"># Note because the total aws api surface area is so large</span>
      <span class="c1"># most cloud trail api event subscription needs two additional</span>
      <span class="c1"># fields.</span>
      <span class="c1">#</span>
      <span class="c1"># For cloud trail events we need to reference the source api call</span>
      <span class="c1"># sources:</span>
      <span class="c1">#  - ec2.amazonaws.com</span>
      <span class="c1">#</span>
      <span class="c1"># To work transparently with existing resource policies, we also</span>
      <span class="c1"># need to specify how to extract the resource ids from the event</span>
      <span class="c1"># via jmespath so that the resources can be queried.</span>
      <span class="c1"># ids: &quot;detail.responseElements.instancesSet.items[].instanceId&quot;</span>
      <span class="c1">#</span>
      <span class="c1"># For very common api calls for policies, some shortchuts have</span>
      <span class="c1"># been defined to allow for easier policy writing as for the</span>
      <span class="c1"># RunInstances api call above.</span>
      <span class="c1">#</span>

    <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">or</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">tag:required1</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">tag:required2</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
    <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stop</span>

  <span class="c1"># On EC2 Instance state events (real time, seconds)</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-require-encrypted-volumes</span>
    <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
    <span class="l l-Scalar l-Scalar-Plain">mode</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-instance-state</span>
      <span class="l l-Scalar l-Scalar-Plain">events</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pending</span>
    <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ebs</span>
        <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Encrypted</span>
        <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
    <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mark</span>
      <span class="c1"># TODO delete instance volumes that</span>
      <span class="c1"># are not set to delete on terminate</span>
      <span class="c1"># currently we have a poll policy that</span>
      <span class="c1"># handles this.</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">terminate</span>

  <span class="c1"># Periodic Function</span>
  <span class="c1"># Syntax for scheduler per http://goo.gl/x3oMQ4</span>
  <span class="c1"># Supports both rate per unit time and cron expressions</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">s3-bucket-check</span>
    <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">s3</span>
    <span class="l l-Scalar l-Scalar-Plain">mode</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">periodic</span>
      <span class="l l-Scalar l-Scalar-Plain">schedule</span><span class="p p-Indicator">:</span> <span class="s">&quot;rate(1</span><span class="nv"> </span><span class="s">day)&quot;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developer Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="ec2.html">EC2 Policy Definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="s3.html">S3 Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="comparisons.html">Comparisons</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Lambda Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cloud-watch-events">Cloud Watch Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloud-maid-integration">Cloud Maid Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
            <p class="searchtip" style="font-size: 90%">
                Enter search terms or a module, class or function name.
            </p>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="comparisons.html" title="Comparisons"
              >previous</a> |
            <a href="py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="_sources/lambda.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Capital One Services, LLC.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>