

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Mu &mdash; Cloud Custodian 1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/c1_labs.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Cloud Custodian 1.0 documentation" href="../index.html"/>
        <link rel="up" title="Architecture" href="index.html"/>
        <link rel="next" title="Deployment" href="deployment.html"/>
        <link rel="prev" title="Terms" href="architecture.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Cloud Custodian
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Architecture</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Terms</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#policy-execution">Policy Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#model-definition">Model Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#operations-design-goals">Operations Design Goals</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#not-yet">Not yet</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Mu</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#aws-cloud-config">AWS Cloud Config</a></li>
<li class="toctree-l3"><a class="reference internal" href="#todo">Todo</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html">Deployment</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Quickstart</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../policy/index.html">Policies</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Cloud Custodian</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Architecture</a> &raquo;</li>
      
    <li>Mu</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mu">
<h1>Mu<a class="headerlink" href="#mu" title="Permalink to this headline">¶</a></h1>
<p>We need to load policies for lambda functions a bit differently so that
they can create the resources needed.</p>
<p>For full lifecycle management we need to be able to determine</p>
<blockquote>
<div><ul class="simple">
<li>all resources associated to a given policy</li>
<li>all resources created by maid</li>
<li>diff of current resources to goal state of resources</li>
<li>remove previous policy lambdas and their event sources
- we need either the previous config file or we need to assume only one maid running lambdas in a given account.</li>
</ul>
</div></blockquote>
<p>Sample interactions</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">$ cloud-maid resources -c config.yml</span>

 <span class="l l-Scalar l-Scalar-Plain">lambda</span><span class="p p-Indicator">:</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">function</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">name</span>
     <span class="l l-Scalar l-Scalar-Plain">sources</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">source info</span>
</pre></div>
</div>
<p>Given an event that comes in from one of a number of sources,
per event source we need to be able to extract the rseource
identities and then query state for them and before processing
filters and actions.
Lambda Developer Notes
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-</p>
<div class="section" id="aws-cloud-config">
<h2>AWS Cloud Config<a class="headerlink" href="#aws-cloud-config" title="Permalink to this headline">¶</a></h2>
<p>One event source is using AWS Cloud Config, which provides versioned
json representation of objects into s3 with rules execution against
them.  Config Rules allow for lambda execution against these resource
states to determine compliance along with a nice dashboard targeted
towards visualizing compliance information over time. At the moment
config rules execute after the resource is already active, based on the
underlying resource poll and config snapshot delivery.</p>
<p>Underlying the hood aws config and config rules, appear to be just
productizing a poll of some resources into json files in s3 with
lambda and versioned metrics reports. At the moment config rules
only support items managed under the ec2 api (ec2, ebs, network) which
means they have significant coverage gap when looking at the totality
of aws services since they only cover a single api. As a result atm,
they are best suited to orgs that are using a small subset of aws that
requires audit (ie. just ec2) and prefer a pre-configured dashboard on
that subset. Of course overtime the config service will evolve.</p>
<p>However for capabilities and reporting around compliance Netflix
security monkey would be a better choice atm imo. Maid distinguishes
in its configurable policy engine, as opposed to hard coded, ability
to run serverless, better integration with current best aws practices
and provides remediation and enforcement capabilities.</p>
<p>Open question on config rules, Its unclear if rules execute against
only on a delta to a resource or against each config snapshot..</p>
<p>For a wider range of coverage and functionality we turn to</p>
<p>TODO:</p>
<ul class="simple">
<li>Resource Manager Abstraction for all policies (or just policy
collection).</li>
<li>Lambda Manager Update Func Configuration</li>
<li>Cli tools for listing maid provisioned resources</li>
</ul>
<p># S3 Uploads</p>
<blockquote>
<div><ul class="simple">
<li>Zip Files idempotency is a bit hard to define, we can&#8217;t currently
tag the lambda with git revisions, and zip files track mod times.</li>
<li>We&#8217;re actually uploading policy specific lambda functions, as we
bake the policy into the function code. So we need to track two
separate versions, the policy version and the maid code version.</li>
<li>With s3 for the function code, we can track this information better
both via metadata and/or versioning.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="todo">
<h2>Todo<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h2>
<p>Maid additionally could use lambda execution for resource intensive policy
actions, using dynamodb for results aggregation, and a periodic result checker,
alternatively sqs with periodic aggregator, or when lambda is vpc accessible
elasticache.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="deployment.html" class="btn btn-neutral float-right" title="Deployment" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="architecture.html" class="btn btn-neutral" title="Terms" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Capital One Services, LLC.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>