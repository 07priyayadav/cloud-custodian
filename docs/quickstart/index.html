

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started &mdash; Cloud Custodian  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/c1_labs.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Cloud Custodian  documentation" href="../index.html"/>
        <link rel="next" title="Monitoring your environment" href="usage.html"/>
        <link rel="prev" title="Deployment" href="../overview/deployment.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Cloud Custodian
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#install-cloud-custodian">Install Cloud Custodian</a></li>
<li class="toctree-l2"><a class="reference internal" href="#write-your-first-policy">Write your first policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-your-policy">Run your policy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting-tinkering">Troubleshooting &amp; Tinkering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#explore-cloud-custodian">Explore Cloud Custodian</a></li>
<li class="toctree-l2"><a class="reference internal" href="#monitor-resources">Monitor resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Monitoring your environment</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="offhours.html">Example offhours policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="tagCompliance.html">Example tag compliance policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usecases/index.html">Use Cases</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AWS Lambda</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../policy/lambda.html">Lambda Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policy/mu.html">Mu - Lambda Lifecycle Management</a></li>
</ul>
<p class="caption"><span class="caption-text">Policies reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../policy/index.html">Resources and Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filters.html">Filters</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contributing to Cloud Custodian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer.html">Developer Install and Testing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Cloud Custodian</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Getting Started</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<span id="quickstart"></span><h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>See also the readme in the GitHub repository.</p>
<ul class="simple">
<li><a class="reference internal" href="#install-cc"><span class="std std-ref">Install Cloud Custodian</span></a></li>
<li><a class="reference internal" href="#write-policy"><span class="std std-ref">Write your first policy</span></a></li>
<li><a class="reference internal" href="#explore-cc"><span class="std std-ref">Explore Cloud Custodian</span></a></li>
<li><a class="reference internal" href="#monitor-cc"><span class="std std-ref">Monitor resources</span></a></li>
</ul>
<div class="section" id="install-cloud-custodian">
<span id="install-cc"></span><h2>Install Cloud Custodian<a class="headerlink" href="#install-cloud-custodian" title="Permalink to this headline">¶</a></h2>
<p>To install Cloud Custodian, just run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pip install c7n
</pre></div>
</div>
</div>
<div class="section" id="write-your-first-policy">
<span id="write-policy"></span><h2>Write your first policy<a class="headerlink" href="#write-your-first-policy" title="Permalink to this headline">¶</a></h2>
<p>A policy specifies the following items:</p>
<ul class="simple">
<li>The type of resource to run the policy against</li>
<li>Filters to narrow down the set of resources</li>
<li>Actions to take on the filtered set of resources</li>
</ul>
<p>For this tutorial, let&#8217;s stop all EC2 instances that are tagged with
<code class="docutils literal"><span class="pre">Custodian</span></code>. To get started, go make an EC2 instance in your <a class="reference external" href="https://console.aws.amazon.com/">AWS console</a>, and tag it with the key <code class="docutils literal"><span class="pre">Custodian</span></code> (any
value).  Also, make sure you have an access key handy.</p>
<p>Then, create a file named <code class="docutils literal"><span class="pre">custodian.yml</span></code> with this content:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">policies</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-first-policy</span>
    <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
    <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;tag:Custodian&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stop</span>
</pre></div>
</div>
</div>
<div class="section" id="run-your-policy">
<span id="run-policy"></span><h2>Run your policy<a class="headerlink" href="#run-your-policy" title="Permalink to this headline">¶</a></h2>
<p>Now, run Custodian:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span> <span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span> custodian run --output-dir<span class="o">=</span>. --config<span class="o">=</span>custodian.yml
</pre></div>
</div>
<p>If successful, you should see output similar to the following on the command line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">2016</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">06</span><span class="p">,</span><span class="mi">133</span><span class="p">:</span> <span class="n">custodian</span><span class="o">.</span><span class="n">policy</span><span class="p">:</span><span class="n">INFO</span> <span class="n">Running</span> <span class="n">policy</span> <span class="n">my</span><span class="o">-</span><span class="n">first</span><span class="o">-</span><span class="n">policy</span> <span class="n">resource</span><span class="p">:</span> <span class="n">ec2</span> <span class="n">region</span><span class="p">:</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span> <span class="n">c7n</span><span class="p">:</span><span class="mf">0.8</span><span class="o">.</span><span class="mf">21.2</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">07</span><span class="p">,</span><span class="mi">514</span><span class="p">:</span> <span class="n">custodian</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">ec2</span><span class="p">:</span><span class="n">INFO</span> <span class="n">Filtered</span> <span class="kn">from</span> <span class="mi">3</span> <span class="n">to</span> <span class="mi">1</span> <span class="n">ec2</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">07</span><span class="p">,</span><span class="mi">514</span><span class="p">:</span> <span class="n">custodian</span><span class="o">.</span><span class="n">policy</span><span class="p">:</span><span class="n">INFO</span> <span class="n">policy</span><span class="p">:</span> <span class="n">my</span><span class="o">-</span><span class="n">first</span><span class="o">-</span><span class="n">policy</span> <span class="n">resource</span><span class="p">:</span><span class="n">ec2</span> <span class="n">has</span> <span class="n">count</span><span class="p">:</span><span class="mi">1</span> <span class="n">time</span><span class="p">:</span><span class="mf">1.38</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">07</span><span class="p">,</span><span class="mi">515</span><span class="p">:</span> <span class="n">custodian</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span><span class="n">INFO</span> <span class="n">Stop</span> <span class="mi">1</span> <span class="n">of</span> <span class="mi">1</span> <span class="n">instances</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">08</span><span class="p">,</span><span class="mi">188</span><span class="p">:</span> <span class="n">custodian</span><span class="o">.</span><span class="n">policy</span><span class="p">:</span><span class="n">INFO</span> <span class="n">policy</span><span class="p">:</span> <span class="n">my</span><span class="o">-</span><span class="n">first</span><span class="o">-</span><span class="n">policy</span> <span class="n">action</span><span class="p">:</span> <span class="n">stop</span> <span class="n">resources</span><span class="p">:</span> <span class="mi">1</span> <span class="n">execution_time</span><span class="p">:</span> <span class="mf">0.67</span>
</pre></div>
</div>
<p>You should also find a new <code class="docutils literal"><span class="pre">my-first-policy</span></code> directory with a log and other
files (subsequent runs will append to the log by default rather than
overwriting it). Lastly, you should find the instance stopping or stopped in
your AWS console. Congratulations, and welcome to Custodian!</p>
<p>For more information on basic concepts and terms, check the <a class="reference internal" href="../overview/glossary.html#glossary"><span class="std std-ref">glossary</span></a>. See our extended examples of an <a class="reference internal" href="offhours.html#offhours"><span class="std std-ref">offhours policy</span></a>
and a <a class="reference internal" href="tagCompliance.html#tagcompliance"><span class="std std-ref">tag compliance policy</span></a>, or browse all of our
<a class="reference internal" href="../usecases/index.html#usecases"><span class="std std-ref">use case recipes</span></a>.</p>
<div class="section" id="troubleshooting-tinkering">
<h3>Troubleshooting &amp; Tinkering<a class="headerlink" href="#troubleshooting-tinkering" title="Permalink to this headline">¶</a></h3>
<p>If you are not using the <code class="docutils literal"><span class="pre">us-east-1</span></code> region, then you&#8217;ll need to specify that
as well, either on the command line or in an environment variable:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>--region<span class="o">=</span>us-west-1
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">AWS_DEFAULT_REGION</span><span class="o">=</span>us-west-1
</pre></div>
</div>
<p>The policy is validated automatically when you run it, but you can also
validate it separately:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ custodian validate -c custodian.yml
</pre></div>
</div>
<p>You can also check which resources are identified by the policy, without
running any actions on the resources:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ custodian run --dryrun -c custodian.yml -s .
</pre></div>
</div>
</div>
</div>
<div class="section" id="explore-cloud-custodian">
<span id="explore-cc"></span><h2>Explore Cloud Custodian<a class="headerlink" href="#explore-cloud-custodian" title="Permalink to this headline">¶</a></h2>
<p>Run <code class="docutils literal"><span class="pre">custodian</span> <span class="pre">-h</span></code> to see a list of available commands.</p>
<p>Run <code class="docutils literal"><span class="pre">custodian</span> <span class="pre">schema</span></code> to see the complete list of AWS resources against
which you can run policies. To invoke command-line help with more information
about policy schema details, run <code class="docutils literal"><span class="pre">custodian</span> <span class="pre">schema</span> <span class="pre">-h</span></code>.</p>
<p>Run <code class="docutils literal"><span class="pre">custodian</span> <span class="pre">schema</span> <span class="pre">&lt;resource&gt;</span></code> to see the available <a class="reference internal" href="../policy/index.html#policy"><span class="std std-ref">filters and
actions</span></a> for each resource.</p>
<p>Drill down to get more information about available policy settings for each
resource, where the model for the command is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ custodian schema &lt;resource&gt;.&lt;category&gt;.&lt;item&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ custodian schema s3.filters.is-log-target
</pre></div>
</div>
<p>provides the following information:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Help</span>
<span class="o">----</span>

<span class="n">Filter</span> <span class="ow">and</span> <span class="k">return</span> <span class="n">buckets</span> <span class="n">are</span> <span class="n">log</span> <span class="n">destinations</span><span class="o">.</span>

<span class="n">Not</span> <span class="n">suitable</span> <span class="k">for</span> <span class="n">use</span> <span class="ow">in</span> <span class="k">lambda</span> <span class="n">on</span> <span class="n">large</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">api</span>
<span class="n">heavy</span> <span class="n">process</span> <span class="n">to</span> <span class="n">detect</span> <span class="n">scan</span> <span class="nb">all</span> <span class="n">possible</span> <span class="n">log</span> <span class="n">sources</span><span class="o">.</span>

<span class="n">Sources</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">elb</span> <span class="p">(</span><span class="n">Access</span> <span class="n">Log</span><span class="p">)</span>
  <span class="o">-</span> <span class="n">s3</span> <span class="p">(</span><span class="n">Access</span> <span class="n">Log</span><span class="p">)</span>
  <span class="o">-</span> <span class="n">cfn</span> <span class="p">(</span><span class="n">Template</span> <span class="n">writes</span><span class="p">)</span>
  <span class="o">-</span> <span class="n">cloudtrail</span>

<span class="p">:</span><span class="n">example</span><span class="p">:</span>

    <span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">:</span> <span class="n">yaml</span>

        <span class="n">policies</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">s3</span><span class="o">-</span><span class="n">log</span><span class="o">-</span><span class="n">bucket</span>
            <span class="n">resource</span><span class="p">:</span> <span class="n">s3</span>
            <span class="n">filters</span><span class="p">:</span>
              <span class="o">-</span> <span class="nb">type</span><span class="p">:</span> <span class="ow">is</span><span class="o">-</span><span class="n">log</span><span class="o">-</span><span class="n">target</span>

<span class="n">Schema</span>
<span class="o">------</span>

<span class="p">{</span>   <span class="s1">&#39;additionalProperties&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span>   <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="p">{</span>   <span class="s1">&#39;enum&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;is-log-target&#39;</span><span class="p">]},</span>
                      <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">{</span>   <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;boolean&#39;</span><span class="p">}},</span>
    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="monitor-resources">
<span id="monitor-cc"></span><h2>Monitor resources<a class="headerlink" href="#monitor-resources" title="Permalink to this headline">¶</a></h2>
<p>Additional commands let you monitor your services in detail.</p>
<p>You can generate metrics by specifying the boolean metrics flag:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ custodian run -c &lt;policyfile&gt;.yml -s &lt;output_directory&gt; --metrics
</pre></div>
</div>
<p>You can also upload Cloud Custodian logs to CloudWatch logs:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ custodian run -c &lt;policyfile&gt;.yml --log-group=/cloud-custodian/&lt;dev-account&gt;/&lt;region&gt;
</pre></div>
</div>
<p>And you can output logs and resource records to S3:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ custodian run -c &lt;policyfile&gt;.yml -s s3://&lt;my-bucket&gt;&lt;my-prefix&gt;
</pre></div>
</div>
<p>For details, see <a class="reference internal" href="usage.html#usage"><span class="std std-ref">Monitoring your environment</span></a>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="usage.html" class="btn btn-neutral float-right" title="Monitoring your environment" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../overview/deployment.html" class="btn btn-neutral" title="Deployment" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Capital One Services, LLC.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>